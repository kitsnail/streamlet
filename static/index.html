<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0F172A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>视频库 - Streamlet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        .video-card { 
            touch-action: manipulation;
        }
        .video-card:active { 
            transform: scale(0.98);
        }
        .thumbnail-placeholder {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .toast-enter { animation: slideIn 0.3s ease-out; }
        .toast-exit { animation: slideOut 0.3s ease-in forwards; }
        @keyframes slideIn {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-100%); opacity: 0; }
        }
        /* Safe area for notch devices */
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        /* Hide scrollbar on mobile */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Touch-friendly input */
        input, select, textarea { font-size: 16px !important; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0F172A',
                        accent: '#3B82F6',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 min-h-screen safe-top safe-bottom">
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 left-4 right-4 z-[60] flex flex-col gap-2 max-w-sm mx-auto"></div>

    <!-- Mobile Header -->
    <header class="fixed top-0 left-0 right-0 bg-slate-800/95 backdrop-blur-lg border-b border-slate-700/50 z-50 safe-top">
        <div class="px-4 py-3">
            <!-- Logo Row -->
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-accent rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-white font-semibold text-lg">Streamlet</span>
                </div>
                <div class="flex items-center gap-2">
                    <a href="/playlists" class="p-2 text-slate-300 hover:text-white active:bg-slate-700 rounded-lg transition-colors" aria-label="播放列表">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </a>
                    <button onclick="logout()" class="p-2 text-slate-400 hover:text-white active:bg-slate-700 rounded-lg" aria-label="退出登录">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Search & Filter Row -->
            <div class="flex gap-2">
                <div class="flex-1 relative">
                    <input
                        type="search"
                        id="searchInput"
                        placeholder="搜索视频..."
                        class="w-full px-4 py-2.5 pl-10 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-accent"
                    >
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <select id="sortSelect" class="px-3 py-2.5 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-accent cursor-pointer">
                    <option value="modified">最新</option>
                    <option value="hotness">热度</option>
                    <option value="views">播放</option>
                    <option value="likes">喜欢</option>
                    <option value="name">名称</option>
                    <option value="size">大小</option>
                </select>
                <button onclick="toggleOrder()" id="orderBtn" class="px-3 py-2.5 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-accent flex items-center justify-center min-w-[44px]" title="切换排序方向">
                    <svg id="orderIcon" class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>

            <!-- Duration Filter Row -->
            <div class="flex gap-2 mt-2">
                <select id="durationMinSelect" class="flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-accent cursor-pointer text-sm">
                    <option value="0">最短时长</option>
                    <option value="5">5分钟+</option>
                    <option value="10">10分钟+</option>
                    <option value="15">15分钟+</option>
                    <option value="20">20分钟+</option>
                    <option value="30">30分钟+</option>
                    <option value="45">45分钟+</option>
                    <option value="60">1小时+</option>
                    <option value="90">1.5小时+</option>
                    <option value="120">2小时+</option>
                </select>
                <span class="text-slate-400 self-center text-sm">—</span>
                <select id="durationMaxSelect" class="flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-accent cursor-pointer text-sm">
                    <option value="0">不限</option>
                    <option value="10">10分钟内</option>
                    <option value="20">20分钟内</option>
                    <option value="30">30分钟内</option>
                    <option value="45">45分钟内</option>
                    <option value="60">1小时内</option>
                    <option value="90">1.5小时内</option>
                    <option value="120">2小时内</option>
                    <option value="180">3小时内</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-40 pb-20 px-4">
        <!-- Stats -->
        <div class="mb-4 flex items-center justify-between">
            <p class="text-slate-400 text-sm">
                共 <span id="totalCount" class="text-white font-semibold">0</span> 个视频
            </p>
            <div id="pageInfo" class="text-slate-400 text-sm">
                <span id="currentPage">1</span>/<span id="totalPages">1</span>
            </div>
        </div>

        <!-- Video Grid - 2 columns on mobile -->
        <div id="videoGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
            <!-- Loading skeleton -->
            <div class="animate-pulse bg-slate-800 rounded-xl aspect-video"></div>
            <div class="animate-pulse bg-slate-800 rounded-xl aspect-video"></div>
            <div class="animate-pulse bg-slate-800 rounded-xl aspect-video"></div>
            <div class="animate-pulse bg-slate-800 rounded-xl aspect-video"></div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-16">
            <svg class="mx-auto w-16 h-16 text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <p class="text-slate-400 text-lg">暂无视频</p>
            <p class="text-slate-500 text-sm mt-2">请检查视频目录配置</p>
        </div>

        <!-- Load More Button -->
        <div id="loadMoreArea" class="hidden mt-6">
            <button onclick="loadMore()" id="loadMoreBtn" class="w-full py-3 bg-slate-800 hover:bg-slate-700 active:bg-slate-600 text-white font-medium rounded-xl transition-colors cursor-pointer">
                加载更多
            </button>
        </div>
    </main>

    <!-- Add to Playlist Modal -->
    <div id="playlistModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 p-0 sm:p-4">
        <div class="bg-slate-800 rounded-t-2xl sm:rounded-2xl p-4 sm:p-6 w-full sm:max-w-md max-h-[80vh] overflow-y-auto safe-bottom">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-white">添加到播放列表</h2>
                <button onclick="hidePlaylistModal()" class="p-2 text-slate-400 hover:text-white active:bg-slate-700 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div id="playlistList" class="space-y-2"></div>
            
            <div class="mt-4 pt-4 border-t border-slate-700">
                <p class="text-slate-400 text-sm mb-3">或创建新播放列表</p>
                <form id="createPlaylistForm" class="flex gap-2">
                    <input
                        type="text"
                        id="newPlaylistName"
                        placeholder="播放列表名称"
                        class="flex-1 px-4 py-2.5 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-accent"
                    >
                    <button type="submit" class="px-4 py-2.5 bg-accent hover:bg-blue-600 active:bg-blue-700 text-white font-medium rounded-xl transition-colors cursor-pointer">
                        创建
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1, totalPages = 1, pageSize = 50;
        let currentSearch = '', currentSort = 'modified', currentOrder = 'desc';
        let currentDurationMin = 0, currentDurationMax = 0;
        let searchTimeout = null;
        let currentVideoPath = null;
        let playlists = [];

        // Toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const icon = type === 'success' 
                ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'
                : type === 'error'
                ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>'
                : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            
            toast.className = `toast-enter ${bgColor} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3`;
            toast.innerHTML = `${icon}<span class="font-medium">${message}</span>`;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function formatSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function renderVideo(video, index) {
            const thumbnailUrl = `/api/thumbnail?video=${encodeURIComponent(video.path)}`;
            const previewUrl = `/api/preview?video=${encodeURIComponent(video.path)}`;
            const playerUrl = buildPlayerUrl(video.path, index);
            
            return `
                <div class="video-card bg-slate-800 rounded-xl overflow-hidden border border-slate-700/50 active:border-accent/50 transition-all" 
                     onmouseenter="startPreview(this, '${previewUrl}')" 
                     onmouseleave="stopPreview(this)"
                     ontouchstart="startPreview(this, '${previewUrl}')"
                     ontouchend="stopPreview(this)">
                    <a href="${playerUrl}" onclick="recordView('${video.path}', '${video.name.replace(/'/g, "\\'")}')">
                        <div class="aspect-video thumbnail-placeholder relative overflow-hidden">
                            <img src="${thumbnailUrl}" alt="${video.name}" class="w-full h-full object-cover preview-thumb" loading="lazy" onerror="this.style.display='none';">
                            <video class="w-full h-full object-cover hidden preview-video" muted loop playsinline preload="none"></video>
                            <div class="absolute bottom-1 right-1 bg-black/70 px-1.5 py-0.5 rounded text-white text-xs flex items-center gap-0.5 pointer-events-none">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                ${formatNumber(video.views)}
                            </div>
                        </div>
                    </a>
                    <div class="p-2">
                        <h3 class="text-white text-sm font-medium line-clamp-2 leading-tight" title="${video.name}">${video.name}</h3>
                        <div class="flex items-center justify-between mt-1.5">
                            <div class="flex items-center gap-2 text-xs text-slate-400">
                                <span>${formatSize(video.size)}</span>
                                ${video.duration ? `<span>•</span><span>${video.duration}</span>` : ''}
                            </div>
                            <div class="flex items-center gap-1">
                                <button onclick="event.preventDefault(); event.stopPropagation(); toggleLike('${video.path}', '${video.name.replace(/'/g, "\\'")}', this)" 
                                    class="p-1 ${video.liked ? 'text-red-400' : 'text-slate-400'} active:bg-slate-700 rounded transition-colors" 
                                    aria-label="${video.liked ? '取消喜欢' : '喜欢'}">
                                    <svg class="w-4 h-4 ${video.liked ? 'fill-current text-red-500' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                </button>
                                <button onclick="event.preventDefault(); event.stopPropagation(); showPlaylistModal('${video.path}')" 
                                    class="p-1 text-slate-400 active:bg-slate-700 rounded transition-colors" 
                                    aria-label="添加到播放列表">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        let previewTimeout = null;

        function startPreview(card, previewUrl) {
            clearTimeout(previewTimeout);
            previewTimeout = setTimeout(() => {
                const video = card.querySelector('.preview-video');
                const thumb = card.querySelector('.preview-thumb');
                if (video && thumb) {
                    video.src = previewUrl;
                    video.classList.remove('hidden');
                    thumb.classList.add('hidden');
                    video.play().catch(() => {});
                }
            }, 500); // Wait 500ms before showing preview
        }

        function stopPreview(card) {
            clearTimeout(previewTimeout);
            const video = card.querySelector('.preview-video');
            const thumb = card.querySelector('.preview-thumb');
            if (video && thumb) {
                video.pause();
                video.currentTime = 0;
                video.src = '';
                video.classList.add('hidden');
                thumb.classList.remove('hidden');
            }
        }

        async function recordView(path, name) {
            try { await fetch('/api/view', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ path, name }) }); } catch (e) {}
        }

        async function toggleLike(path, name, btn) {
            try {
                const response = await fetch('/api/like', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ path, name }) });
                const data = await response.json();
                const icon = btn.querySelector('svg');
                if (data.liked) {
                    btn.classList.remove('text-slate-400');
                    btn.classList.add('text-red-400');
                    icon.classList.add('fill-current', 'text-red-500');
                } else {
                    btn.classList.remove('text-red-400');
                    btn.classList.add('text-slate-400');
                    icon.classList.remove('fill-current', 'text-red-500');
                }
            } catch (e) {}
        }

        async function showPlaylistModal(videoPath) {
            currentVideoPath = videoPath;
            try {
                const response = await fetch('/api/playlists');
                const data = await response.json();
                playlists = data.playlists || [];
                
                const list = document.getElementById('playlistList');
                if (playlists.length === 0) {
                    list.innerHTML = '<p class="text-slate-400 text-center py-4 text-sm">暂无播放列表，请在下方创建</p>';
                } else {
                    list.innerHTML = playlists.map(p => `
                        <button onclick="addToPlaylist('${p.id}')" class="w-full px-4 py-3 bg-slate-700 hover:bg-slate-600 active:bg-slate-600 text-white font-medium rounded-xl transition-colors text-left flex items-center justify-between">
                            <span class="truncate">${p.name}</span>
                            <span class="text-slate-400 text-sm ml-2 flex-shrink-0">${p.videos ? p.videos.length : 0}</span>
                        </button>
                    `).join('');
                }
                document.getElementById('playlistModal').classList.remove('hidden');
                document.getElementById('newPlaylistName').value = '';
            } catch (e) { console.error(e); }
        }

        function hidePlaylistModal() {
            document.getElementById('playlistModal').classList.add('hidden');
            currentVideoPath = null;
        }

        async function addToPlaylist(playlistId) {
            try {
                const response = await fetch('/api/playlists/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ playlistId, videoPath: currentVideoPath })
                });
                if (response.ok) {
                    hidePlaylistModal();
                    showToast('已添加到播放列表');
                }
            } catch (e) { showToast('添加失败', 'error'); }
        }

        document.getElementById('createPlaylistForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('newPlaylistName').value.trim();
            if (!name) { showToast('请输入名称', 'error'); return; }

            try {
                const response = await fetch('/api/playlists', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description: '' })
                });
                if (response.ok) {
                    showToast('播放列表已创建');
                    await showPlaylistModal(currentVideoPath);
                }
            } catch (e) { showToast('创建失败', 'error'); }
        });

        function renderVideos(videos) {
            const grid = document.getElementById('videoGrid'), empty = document.getElementById('emptyState');
            if (!videos.length) { grid.classList.add('hidden'); empty.classList.remove('hidden'); return; }
            grid.classList.remove('hidden'); empty.classList.add('hidden');
            grid.innerHTML = videos.map((v, i) => renderVideo(v, i)).join('');
        }

        function buildPlayerUrl(videoPath, index) {
            const params = new URLSearchParams();
            params.set('v', videoPath);
            params.set('index', index.toString());
            params.set('page', currentPage.toString());
            params.set('pageSize', pageSize.toString());
            params.set('sort', currentSort);
            params.set('order', currentOrder);
            if (currentSearch) params.set('search', currentSearch);
            params.set('autoPlaylist', '1');
            return `/player?${params.toString()}`;
        }

        function toggleOrder() {
            currentOrder = currentOrder === 'desc' ? 'asc' : 'desc';
            const icon = document.getElementById('orderIcon');
            icon.style.transform = currentOrder === 'asc' ? 'rotate(180deg)' : 'rotate(0deg)';
            currentPage = 1;
            fetchVideos();
        }

        function updateUI() {
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            // Show/hide load more button
            const loadMoreArea = document.getElementById('loadMoreArea');
            if (currentPage < totalPages) {
                loadMoreArea.classList.remove('hidden');
            } else {
                loadMoreArea.classList.add('hidden');
            }
        }

        function loadMore() {
            if (currentPage < totalPages) {
                currentPage++;
                fetchVideos(true);
            }
        }

        async function fetchVideos(append = false) {
            try {
                const params = new URLSearchParams({ page: currentPage, pageSize: pageSize, sort: currentSort, order: currentOrder });
                if (currentSearch) params.append('search', currentSearch);
                if (currentDurationMin > 0) params.append('durationMin', currentDurationMin);
                if (currentDurationMax > 0) params.append('durationMax', currentDurationMax);
                const response = await fetch(`/api/videos?${params}`);
                if (response.status === 401) { window.location.href = '/login'; return; }
                const data = await response.json();
                totalPages = data.totalPages || 1;
                document.getElementById('totalCount').textContent = data.total || 0;
                
                if (append) {
                    const grid = document.getElementById('videoGrid');
                    grid.innerHTML += data.videos.map((v, i) => renderVideo(v, (currentPage - 1) * pageSize + i)).join('');
                } else {
                    renderVideos(data.videos || []);
                }
                updateUI();
                
                if (!append) window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (e) { console.error(e); }
        }

        function logout() { document.cookie = 'token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;'; window.location.href = '/login'; }

        document.getElementById('searchInput').addEventListener('input', (e) => { 
            clearTimeout(searchTimeout); 
            searchTimeout = setTimeout(() => { currentSearch = e.target.value.trim(); currentPage = 1; fetchVideos(); }, 300); 
        });
        document.getElementById('sortSelect').addEventListener('change', (e) => { currentSort = e.target.value; currentPage = 1; fetchVideos(); });
        document.getElementById('durationMinSelect').addEventListener('change', (e) => { 
            currentDurationMin = parseInt(e.target.value) || 0; 
            currentPage = 1; 
            fetchVideos(); 
        });
        document.getElementById('durationMaxSelect').addEventListener('change', (e) => { 
            currentDurationMax = parseInt(e.target.value) || 0; 
            currentPage = 1; 
            fetchVideos(); 
        });

        // Close modal on backdrop click
        document.getElementById('playlistModal').addEventListener('click', (e) => {
            if (e.target.id === 'playlistModal') hidePlaylistModal();
        });

        fetchVideos();
    </script>
</body>
</html>
